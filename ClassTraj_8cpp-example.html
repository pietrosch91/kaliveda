<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>KaliVeda: ClassTraj.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="ROOT.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">KaliVeda
   &#160;<span id="projectnumber">1.10/15</span>
   </div>
   <div id="projectbrief">Heavy-Ion Analysis Toolkit</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">ClassTraj.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<h1>Example of use of the <a class="el" href="classKVRungeKutta.html" title="Adaptive step-size 4th order Runge-Kutta ODE integrator from Numerical Recipes. ">KVRungeKutta</a> class</h1>
<p>Implementation of a classical trajectory calculation for heavy ion collisions</p>
<h3>Friction parameter</h3>
<p><code>alpha=240</code> gives maximum fusion X-section for 40Ca+60Ni@6MeV/u (bfus&lt;=5.25fm: 866mb)</p>
<p><code>alpha=750</code> gives 66mb of fusion for 84Kr(605 MeV)+238U</p><ul>
<li>measured fusion-fission Xsec from PRL 33, 502 (1974): 55+/-15 mb</li>
</ul>
<div class="fragment"><div class="line"><span class="comment">//Created by KVClassFactory on Thu Jun 24 14:22:17 2010</span></div><div class="line"><span class="comment">//Author: John Frankland,,,</span></div><div class="line"></div><div class="line"><span class="preprocessor">#ifndef __ClassTraj_H</span></div><div class="line"><span class="preprocessor">#define __ClassTraj_H</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="KVRungeKutta_8h.html">KVRungeKutta.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="KVWilckeReactionParameters_8h.html">KVWilckeReactionParameters.h</a>&quot;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;TArc.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;TGraph.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;TCanvas.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;TMarker.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;TTree.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;TFile.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;TLatex.h&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">class </span>ClassTraj : <span class="keyword">public</span> <a name="_a0"></a><a class="code" href="classKVRungeKutta.html">KVRungeKutta</a> {</div><div class="line">   Double_t* coords;</div><div class="line">   Double_t* RP;</div><div class="line">   Double_t* RT;</div><div class="line">   Double_t* VP;</div><div class="line">   Double_t* VT;</div><div class="line">   Double_t RCM[2];</div><div class="line">   Double_t VCM[2];</div><div class="line"></div><div class="line">   <a name="_a1"></a><a class="code" href="classKVWilckeReactionParameters.html">KVWilckeReactionParameters</a> fWilcke;</div><div class="line">   Double_t ELAB, E0;</div><div class="line">   Double_t alpha;<span class="comment">//friction parameter</span></div><div class="line"></div><div class="line">   <span class="comment">//CM trajectory</span></div><div class="line">   TArc* ProjARC;</div><div class="line">   TArc* TargARC;</div><div class="line">   TGraph* ProjTRAJ;</div><div class="line">   Int_t nTRAJPoints;</div><div class="line">   TCanvas* CMPositionPad;</div><div class="line">   TLatex* infox;</div><div class="line">   <span class="comment">//lab trajectory</span></div><div class="line">   TArc* ProjARClab;</div><div class="line">   TArc* TargARClab;</div><div class="line">   TGraph* ProjTRAJlab;</div><div class="line">   TCanvas* LabPositionPad;</div><div class="line">   Int_t nTRAJPointslab;</div><div class="line">   Double_t minDist;</div><div class="line">   Double_t EtotDeb, EtotFin, TKEL, TKE, VPOT;</div><div class="line">   Double_t ThetaProjLab, absThetaProjLab;</div><div class="line">   Double_t EProjLab;</div><div class="line">   Double_t ImpactParameter;</div><div class="line">   Double_t AngMom, RotationAngle;</div><div class="line">   Bool_t fused, inelastic, incoming, interacting, outgoing;</div><div class="line">   Double_t tcon, tsep, RotationTime;</div><div class="line">   Double_t randomX;</div><div class="line"></div><div class="line">   TString sysName;</div><div class="line">   TString colName;</div><div class="line"></div><div class="line">   TFile* theFile;</div><div class="line">   TTree* theTree;</div><div class="line"></div><div class="line">   Bool_t fVisualization;<span class="comment">//true = show trajectories</span></div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line">   ClassTraj(<span class="keyword">const</span> <a name="_a2"></a><a class="code" href="classKVNucleus.html">KVNucleus</a>&amp; proj, <span class="keyword">const</span> <a class="code" href="classKVNucleus.html">KVNucleus</a>&amp; targ, Bool_t viz = kTRUE);</div><div class="line">   <span class="keyword">virtual</span> ~ClassTraj();</div><div class="line"></div><div class="line">   <span class="keywordtype">void</span> SetViz(Bool_t on = kTRUE)</div><div class="line">   {</div><div class="line">      fVisualization = on;</div><div class="line">   }</div><div class="line"></div><div class="line">   <span class="keywordtype">void</span> InitTrajectory(Double_t b, Double_t e, Double_t a = 0);</div><div class="line"></div><div class="line">   Double_t dr(Double_t* rp, Double_t* rt)<span class="keyword"> const</span></div><div class="line"><span class="keyword">   </span>{</div><div class="line">      <span class="keywordflow">return</span> sqrt(pow(rp[0] - rt[0], 2) + pow(rp[1] - rt[1], 2));</div><div class="line">   }</div><div class="line">   Double_t dv(Double_t* vp, Double_t* vt)<span class="keyword"> const</span></div><div class="line"><span class="keyword">   </span>{</div><div class="line">      <span class="keywordflow">return</span> sqrt(pow(vp[0] - vt[0], 2) + pow(vp[1] - vt[1], 2));</div><div class="line">   }</div><div class="line">   Double_t dr_x(Double_t* rp, Double_t* rt)<span class="keyword"> const</span></div><div class="line"><span class="keyword">   </span>{</div><div class="line">      <span class="comment">// x-component of unit vector from target to projectile</span></div><div class="line">      <span class="keywordflow">return</span> (rp[0] - rt[0]) / dr(rp, rt);</div><div class="line">   }</div><div class="line">   Double_t dr_y(Double_t* rp, Double_t* rt)<span class="keyword"> const</span></div><div class="line"><span class="keyword">   </span>{</div><div class="line">      <span class="comment">// y-component of unit vector from target to projectile</span></div><div class="line">      <span class="keywordflow">return</span> (rp[1] - rt[1]) / dr(rp, rt);</div><div class="line">   }</div><div class="line">   Double_t dv_x(Double_t* vp, Double_t* vt)<span class="keyword"> const</span></div><div class="line"><span class="keyword">   </span>{</div><div class="line">      <span class="comment">// x-component of unit vector from target to projectile</span></div><div class="line">      <span class="keywordflow">return</span> (vp[0] - vt[0]) / dv(vp, vt);</div><div class="line">   }</div><div class="line">   Double_t dv_y(Double_t* vp, Double_t* vt)<span class="keyword"> const</span></div><div class="line"><span class="keyword">   </span>{</div><div class="line">      <span class="comment">// y-component of unit vector from target to projectile</span></div><div class="line">      <span class="keywordflow">return</span> (vp[1] - vt[1]) / dv(vp, vt);</div><div class="line">   }</div><div class="line">   <span class="keywordtype">void</span> UpdateARCPositions(Double_t time);</div><div class="line">   Double_t ThetaLabProj()</div><div class="line">   {</div><div class="line">      <span class="keywordflow">return</span> TMath::Sign(TMath::RadToDeg() * acos(</div><div class="line">                            (VP[0] + VCM[0]) /</div><div class="line">                            sqrt(pow(VP[0] + VCM[0], 2) + pow(VP[1] + VCM[1], 2))), VP[1] + VCM[1]);</div><div class="line">   };</div><div class="line">   Double_t ELabProj()</div><div class="line">   {</div><div class="line">      <span class="keywordflow">return</span> 0.5 * fWilcke.<a name="a3"></a><a class="code" href="classKVWilckeReactionParameters.html#acc48f77c3a2bf5ccf068c8c5a7eeb1c9">GetAP</a>() * <a name="a4"></a><a class="code" href="classKVNucleus.html#a488d76ebc458290c101d224aadc6aa93">KVNucleus::u</a>() * (pow(VP[0] + VCM[0], 2) + pow(VP[1] + VCM[1], 2));</div><div class="line">   };</div><div class="line">   Double_t TotalAngularMomentum()</div><div class="line">   {</div><div class="line">      Double_t lz = dv_x(VP, VT) * dr_y(RP, RT) - dv_y(VP, VT) * dr_x(RP, RT);</div><div class="line">      lz *= fWilcke.<a name="a5"></a><a class="code" href="classKVWilckeReactionParameters.html#a7d69791da6a0c5afb8d24461132c6e6c">GetMu</a>() * <a class="code" href="classKVNucleus.html#a488d76ebc458290c101d224aadc6aa93">KVNucleus::u</a>() * dr(RP, RT) * dv(VP, VT) / <a name="a6"></a><a class="code" href="classKVNucleus.html#a0c75d93c3ee22d153ee0fcb3d424cbef">KVNucleus::hbar</a>;</div><div class="line">      <span class="keywordflow">return</span> lz;</div><div class="line">   }</div><div class="line">   Double_t TotalEnergy() <span class="keyword">const</span>;</div><div class="line"></div><div class="line">   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a name="a7"></a><a class="code" href="classKVRungeKutta.html#a19e745dc894fbfa1e4beaf43504aace4">CalcDerivs</a>(Double_t <span class="comment">/*X*/</span>, Double_t* <span class="comment">/*Y*/</span>, Double_t* <span class="comment">/*DY/DX*/</span>);</div><div class="line">   <span class="keywordtype">void</span> Run(Double_t tmin, Double_t tmax, Double_t dt);</div><div class="line">   <span class="keywordtype">void</span> Reset()</div><div class="line">   {</div><div class="line">      <span class="comment">// Reset visualization ready for new trajectories calculation</span></div><div class="line"></div><div class="line">      <span class="keywordflow">if</span> (CMPositionPad) <span class="keyword">delete</span> CMPositionPad;</div><div class="line">      <span class="keywordflow">if</span> (LabPositionPad) <span class="keyword">delete</span> LabPositionPad;</div><div class="line"></div><div class="line">      <span class="keywordflow">if</span> (!ProjARC) {</div><div class="line">         ProjARC = <span class="keyword">new</span> TArc(0, 0, fWilcke.<a name="a8"></a><a class="code" href="classKVWilckeReactionParameters.html#ae1807c694a666ba2bfb46c46731da87b">GetCP</a>());</div><div class="line">         ProjARC-&gt;SetFillColor(kBlue);</div><div class="line">      }</div><div class="line">      <span class="keywordflow">if</span> (!TargARC) {</div><div class="line">         TargARC = <span class="keyword">new</span> TArc(0, 0, fWilcke.<a name="a9"></a><a class="code" href="classKVWilckeReactionParameters.html#a3417c083e35eb05c23fbddcd871e705c">GetCT</a>());</div><div class="line">         TargARC-&gt;SetFillColor(kRed);</div><div class="line">      }</div><div class="line">      <span class="keywordflow">if</span> (!ProjARClab) {</div><div class="line">         ProjARClab = <span class="keyword">new</span> TArc(0, 0, 2 * fWilcke.<a class="code" href="classKVWilckeReactionParameters.html#ae1807c694a666ba2bfb46c46731da87b">GetCP</a>());</div><div class="line">         ProjARClab-&gt;SetFillColor(kBlue);</div><div class="line">      }</div><div class="line">      <span class="keywordflow">if</span> (!TargARClab) {</div><div class="line">         TargARClab = <span class="keyword">new</span> TArc(0, 0, 2 * fWilcke.<a class="code" href="classKVWilckeReactionParameters.html#a3417c083e35eb05c23fbddcd871e705c">GetCT</a>());</div><div class="line">         TargARClab-&gt;SetFillColor(kRed);</div><div class="line">      }</div><div class="line">      CMPositionPad = <span class="keyword">new</span> TCanvas(<span class="stringliteral">&quot;CMPOS&quot;</span>, <span class="stringliteral">&quot;CM Positions&quot;</span>, 800, 500);</div><div class="line">      CMPositionPad-&gt;DrawFrame(-50, -40, 50, 40);</div><div class="line">      TMarker* cmark = <span class="keyword">new</span> TMarker(0, 0, 2);</div><div class="line">      cmark-&gt;SetMarkerSize(2);</div><div class="line">      cmark-&gt;Draw();</div><div class="line">      TArc* rint = <span class="keyword">new</span> TArc(0, 0, fWilcke.<a name="a10"></a><a class="code" href="classKVWilckeReactionParameters.html#a56fcc56a95074f464fab21a0d7ff09b5">GetRint</a>());</div><div class="line">      rint-&gt;SetLineStyle(2);</div><div class="line">      rint-&gt;SetFillStyle(0);</div><div class="line">      rint-&gt;Draw();</div><div class="line">      <span class="keywordflow">if</span> (infox) <span class="keyword">delete</span> infox;</div><div class="line">      infox = <span class="keyword">new</span> TLatex;</div><div class="line">      UpdateInfos(0, 0);</div><div class="line">      infox-&gt;Draw();</div><div class="line">      LabPositionPad = <span class="keyword">new</span> TCanvas(<span class="stringliteral">&quot;LABPOS&quot;</span>, <span class="stringliteral">&quot;Lab Positions&quot;</span>, 800, 500);</div><div class="line">      LabPositionPad-&gt;DrawFrame(-50, -300, 550, 300); <span class="comment">//(-100,-80, 100,80);</span></div><div class="line">      cmark = <span class="keyword">new</span> TMarker(0, 0, 2);</div><div class="line">      cmark-&gt;SetMarkerSize(2);</div><div class="line">      cmark-&gt;Draw();</div><div class="line">   }</div><div class="line">   <span class="keywordtype">void</span> UpdateInfos(Double_t b, Double_t time)</div><div class="line">   {</div><div class="line">      <span class="keywordflow">if</span> (infox) {</div><div class="line">         <span class="keywordflow">if</span> (outgoing)infox-&gt;SetText(-40, -30, Form(<span class="stringliteral">&quot;b=%.1ffm t=%.0ffm/c OUTGOING&quot;</span>, b, time));</div><div class="line">         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (incoming)infox-&gt;SetText(-40, -30, Form(<span class="stringliteral">&quot;b=%.1ffm t=%.0ffm/c INCOMING&quot;</span>, b, time));</div><div class="line">         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (interacting)infox-&gt;SetText(-40, -30, Form(<span class="stringliteral">&quot;b=%.1ffm t=%.0ffm/c INTERACTING&quot;</span>, b, time));</div><div class="line">         <span class="keywordflow">else</span> infox-&gt;SetText(-40, -30, Form(<span class="stringliteral">&quot;b=%.1ffm t=%.0ffm/c&quot;</span>, b, time));</div><div class="line">      }</div><div class="line">   }</div><div class="line">   <span class="keywordtype">void</span> CalcTrajectories(Double_t e, Double_t bmin, Double_t bmax, Double_t db, Double_t tmin, Double_t tmax, Double_t dt, Double_t friction = 0);</div><div class="line">   <span class="keywordtype">void</span> CalcTrajectories(Double_t e, Int_t ntraj, Double_t bmin, Double_t bmax, Double_t tmin, Double_t tmax, Double_t dt, Double_t friction = 0);</div><div class="line"></div><div class="line">   <span class="keywordtype">void</span> InitTree(Double_t e);</div><div class="line">   <span class="keywordtype">void</span> DoOneTraj(Double_t tmin, Double_t friction, Double_t b, Double_t e, Double_t tmax, Double_t dt);</div><div class="line">   ClassDef(ClassTraj, 0) <span class="comment">//Classical trajectory for heavy ion collisions</span></div><div class="line">};</div><div class="line"></div><div class="line"><span class="preprocessor">#endif</span></div></div><!-- fragment --><div class="fragment"><div class="line"><span class="comment">//Created by KVClassFactory on Thu Jun 24 14:22:17 2010</span></div><div class="line"><span class="comment">//Author: John Frankland,,,</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;ClassTraj.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;Riostream.h&quot;</span></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacestd.html">std</a>;</div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="KVTreeAnalyzer_8h.html">KVTreeAnalyzer.h</a>&quot;</span></div><div class="line"></div><div class="line">ClassImp(ClassTraj)</div><div class="line"></div><div class="line">ClassTraj::ClassTraj(<span class="keyword">const</span> <a class="code" href="classKVNucleus.html">KVNucleus</a>&amp; proj, <span class="keyword">const</span> <a class="code" href="classKVNucleus.html">KVNucleus</a>&amp; targ, Bool_t viz)</div><div class="line">   : <a class="code" href="classKVRungeKutta.html">KVRungeKutta</a>(8), fWilcke(proj, targ), fVisualization(viz)</div><div class="line">{</div><div class="line">   <span class="comment">// 2-D problem</span></div><div class="line">   <span class="comment">// x-axis = beam</span></div><div class="line">   <span class="comment">// y-axis = impact parameter</span></div><div class="line">   <span class="comment">// projectile comes from -x direction</span></div><div class="line">   alpha = 0;</div><div class="line">   coords = <span class="keyword">new</span> Double_t [8];</div><div class="line">   RP = coords;</div><div class="line">   RT = coords + 2;</div><div class="line">   VP = coords + 4;</div><div class="line">   VT = coords + 6;</div><div class="line"></div><div class="line">   sysName.Form(<span class="stringliteral">&quot;%s + %s&quot;</span>, proj.<a name="a11"></a><a class="code" href="classKVNucleus.html#a1056abeab22f1aace1e446d9ac2649e6">GetSymbol</a>(), targ.<a class="code" href="classKVNucleus.html#a1056abeab22f1aace1e446d9ac2649e6">GetSymbol</a>());</div><div class="line">   colName.Form(<span class="stringliteral">&quot;%s%s&quot;</span>, proj.<a class="code" href="classKVNucleus.html#a1056abeab22f1aace1e446d9ac2649e6">GetSymbol</a>(), targ.<a class="code" href="classKVNucleus.html#a1056abeab22f1aace1e446d9ac2649e6">GetSymbol</a>());</div><div class="line"></div><div class="line">   fWilcke.<a name="a12"></a><a class="code" href="classKVBase.html#a964cddee845519973d68fc1e69c32b32">Print</a>();</div><div class="line"></div><div class="line">   CMPositionPad = LabPositionPad = 0;</div><div class="line">   ProjARC = TargARC = ProjARClab = TargARClab = 0;</div><div class="line">   infox = 0;</div><div class="line">   <span class="keywordflow">if</span> (fVisualization) Reset();</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> ClassTraj::UpdateARCPositions(Double_t t)</div><div class="line">{</div><div class="line">   ProjARC-&gt;SetX1(RP[0]);</div><div class="line">   ProjARC-&gt;SetY1(RP[1]);</div><div class="line">   TargARC-&gt;SetX1(RT[0]);</div><div class="line">   TargARC-&gt;SetY1(RT[1]);</div><div class="line">   ProjTRAJ-&gt;SetPoint(nTRAJPoints++, RP[0], RP[1]);</div><div class="line">   ProjARClab-&gt;SetX1(RP[0] + RCM[0] + VCM[0]*t);</div><div class="line">   ProjARClab-&gt;SetY1(RP[1] + RCM[1] + VCM[1]*t);</div><div class="line">   TargARClab-&gt;SetX1(RT[0] + RCM[0] + VCM[0]*t);</div><div class="line">   TargARClab-&gt;SetY1(RT[1] + RCM[1] + VCM[1]*t);</div><div class="line">   ProjTRAJlab-&gt;SetPoint(nTRAJPointslab++, RP[0] + RCM[0] + VCM[0]*t, RP[1] + RCM[1] + VCM[1]*t);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line">ClassTraj::~ClassTraj()</div><div class="line">{</div><div class="line">   <span class="keyword">delete</span> [] coords;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> ClassTraj::InitTrajectory(Double_t b, Double_t e, Double_t fric)</div><div class="line">{</div><div class="line">   <span class="comment">// set up trajectory with impact parameter b</span></div><div class="line">   <span class="comment">// energy e mev/nucleon</span></div><div class="line"></div><div class="line">   <span class="keywordflow">if</span> (fVisualization)UpdateInfos(b, 0);</div><div class="line">   alpha = fric;</div><div class="line">   <span class="keywordflow">if</span> (fVisualization) {</div><div class="line">      ProjTRAJ = <span class="keyword">new</span> TGraph;</div><div class="line">      ProjTRAJ-&gt;SetLineWidth(2);</div><div class="line">      ProjTRAJlab = <span class="keyword">new</span> TGraph;</div><div class="line">      ProjTRAJlab-&gt;SetLineWidth(2);</div><div class="line">   }</div><div class="line">   ELAB = e;</div><div class="line">   Double_t R0 = minDist;</div><div class="line">   <span class="comment">// lab coordinates</span></div><div class="line">   RP[0] = -R0;</div><div class="line">   RP[1] = b;</div><div class="line">   RT[0] = RT[1] = 0;</div><div class="line">   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 2; i++) {</div><div class="line">      RCM[i] = (fWilcke.GetAP() * RP[i] + fWilcke.GetAT() * RT[i]) / (1.*fWilcke.GetAC());</div><div class="line">      RP[i] -= RCM[i];</div><div class="line">      RT[i] -= RCM[i];</div><div class="line">   }</div><div class="line"><span class="comment">//    cout &lt;&lt; &quot;CENTRE OF MASS : (&quot; &lt;&lt; RCM[0] &lt;&lt; &quot;,&quot; &lt;&lt; RCM[1] &lt;&lt; &quot;)&quot; &lt;&lt; endl;</span></div><div class="line"><span class="comment">//    cout &lt;&lt; &quot;INITIAL DISTANCE :&quot; &lt;&lt; dr(RP,RT) &lt;&lt; &quot; fm&quot; &lt;&lt; endl;</span></div><div class="line"><span class="comment">//    cout &lt;&lt; &quot;INITIAL POSITIONS :&quot; &lt;&lt; endl;</span></div><div class="line"><span class="comment">//    cout &lt;&lt; &quot;   PROJECTILE : (&quot; &lt;&lt; RP[0] &lt;&lt; &quot;,&quot; &lt;&lt; RP[1] &lt;&lt; &quot;)&quot; &lt;&lt; endl;</span></div><div class="line"><span class="comment">//    cout &lt;&lt; &quot;   TARGET  : (&quot; &lt;&lt; RT[0] &lt;&lt; &quot;,&quot; &lt;&lt; RT[1] &lt;&lt; &quot;)&quot; &lt;&lt; endl;</span></div><div class="line"><span class="comment">//    cout &lt;&lt; &quot;POTENTIAL ENERGY : &quot; &lt;&lt; fWilcke.GetTotalPotential()-&gt;Eval(dr(RP,RT)) &lt;&lt; &quot; MeV&quot; &lt;&lt; endl;</span></div><div class="line"><span class="comment">//    cout &lt;&lt; &quot;CM TOTAL ENERGY : &quot; &lt;&lt; fWilcke.ECM(ELAB) &lt;&lt; &quot; MeV&quot; &lt;&lt; endl;</span></div><div class="line">   E0 = fWilcke.ECM(ELAB) - fWilcke.GetTotalPotential()-&gt;Eval(dr(RP, RT));</div><div class="line"><span class="comment">//    cout &lt;&lt; &quot;INITIAL CM KINETIC ENERGY : &quot; &lt;&lt; E0 &lt;&lt; &quot; MeV&quot; &lt;&lt; endl;</span></div><div class="line">   Double_t V0 = sqrt(2.*E0 / fWilcke.GetMu() / <a name="a13"></a><a class="code" href="classKVNucleus.html#abbe548614194e1c1bde2550fdc3d6f54">KVNucleus::kAMU</a>);</div><div class="line"><span class="comment">//    cout &lt;&lt; &quot;INITIAL PROJECTILE VELOCITY : &quot; &lt;&lt; V0*KVNucleus::C() &lt;&lt; &quot; cm/ns&quot; &lt;&lt; endl;</span></div><div class="line">   <span class="comment">// lab velocities</span></div><div class="line">   VP[0] = V0;</div><div class="line">   VP[1] = VT[0] = VT[1] = 0.;</div><div class="line">   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 2; i++) {</div><div class="line">      VCM[i] = (fWilcke.GetAP() * VP[i] + fWilcke.GetAT() * VT[i]) / (1.*fWilcke.GetAC());</div><div class="line">      VP[i] -= VCM[i];</div><div class="line">      VT[i] -= VCM[i];</div><div class="line">   }</div><div class="line"><span class="comment">//    cout &lt;&lt; &quot;CENTRE OF MASS VELOCITY : &quot; &lt;&lt; VCM[0]*KVNucleus::C() &lt;&lt; &quot; cm/ns&quot; &lt;&lt; endl;</span></div><div class="line"><span class="comment">//    cout &lt;&lt; &quot;INITIAL CM VELOCITIES :&quot; &lt;&lt; endl;</span></div><div class="line"><span class="comment">//    cout &lt;&lt; &quot;   PROJECTILE : &quot; &lt;&lt; VP[0]*KVNucleus::C() &lt;&lt; &quot; cm/ns&quot;  &lt;&lt; endl;</span></div><div class="line"><span class="comment">//    cout &lt;&lt; &quot;   TARGET  : &quot; &lt;&lt; VT[0]*KVNucleus::C() &lt;&lt; &quot; cm/ns&quot; &lt;&lt; endl;</span></div><div class="line"></div><div class="line">   <span class="keywordflow">if</span> (fVisualization) {</div><div class="line">      nTRAJPoints = 0;</div><div class="line">      nTRAJPointslab = 0;</div><div class="line">      UpdateARCPositions(0);</div><div class="line">      CMPositionPad-&gt;cd();</div><div class="line">      ProjARC-&gt;Draw();</div><div class="line">      TargARC-&gt;Draw();</div><div class="line">      ProjTRAJ-&gt;Draw(<span class="stringliteral">&quot;l&quot;</span>);</div><div class="line">      CMPositionPad-&gt;Modified();</div><div class="line">      CMPositionPad-&gt;Update();</div><div class="line">      LabPositionPad-&gt;cd();</div><div class="line">      ProjARClab-&gt;Draw();</div><div class="line">      TargARClab-&gt;Draw();</div><div class="line">      ProjTRAJlab-&gt;Draw(<span class="stringliteral">&quot;l&quot;</span>);</div><div class="line">      LabPositionPad-&gt;Modified();</div><div class="line">      LabPositionPad-&gt;Update();</div><div class="line">   }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> ClassTraj::CalcDerivs(Double_t t, Double_t* Y, Double_t* DYDX)</div><div class="line">{</div><div class="line">   Double_t* rp = Y;</div><div class="line">   Double_t* rt = Y + 2;</div><div class="line">   Double_t* vp = Y + 4;</div><div class="line">   Double_t* vt = Y + 6;</div><div class="line">   Double_t* drp = DYDX;</div><div class="line">   Double_t* drt = DYDX + 2;</div><div class="line">   Double_t* dvp = DYDX + 4;</div><div class="line">   Double_t* dvt = DYDX + 6;</div><div class="line"></div><div class="line">   Double_t distance = dr(rp, rt);</div><div class="line">   Double_t uv_x = dr_x(rp, rt);</div><div class="line">   Double_t uv_y = dr_y(rp, rt);</div><div class="line"></div><div class="line">   Double_t Force = -fWilcke.GetTotalPotential()-&gt;Derivative(distance);</div><div class="line">   <span class="keywordflow">if</span> (TMath::IsNaN(Force)) Force = 0;</div><div class="line"></div><div class="line">   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 2; i++) {</div><div class="line">      drp[i] = vp[i];</div><div class="line">      drt[i] = vt[i];</div><div class="line">   }</div><div class="line">   Double_t fp = Force / (fWilcke.GetAP() * <a class="code" href="classKVNucleus.html#abbe548614194e1c1bde2550fdc3d6f54">KVNucleus::kAMU</a>);</div><div class="line">   dvp[0] = fp * uv_x;</div><div class="line">   dvp[1] = fp * uv_y;</div><div class="line">   Double_t ft = -Force / (fWilcke.GetAT() * <a class="code" href="classKVNucleus.html#abbe548614194e1c1bde2550fdc3d6f54">KVNucleus::kAMU</a>);</div><div class="line">   dvt[0] = ft * uv_x;</div><div class="line">   dvt[1] = ft * uv_y;</div><div class="line"></div><div class="line">   <span class="keywordflow">if</span> (fInitialDeriv) {</div><div class="line">      <span class="keywordflow">if</span> (distance &lt;= minDist)minDist = distance;</div><div class="line">      <span class="keywordflow">if</span> (incoming &amp;&amp; distance &lt; fWilcke.GetRint() + 10.) {</div><div class="line">         incoming = kFALSE;</div><div class="line">         interacting = kTRUE;</div><div class="line">      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (interacting &amp;&amp; distance &gt; fWilcke.GetRint() + 10.) {</div><div class="line">         interacting = kFALSE;</div><div class="line">         outgoing = kTRUE;</div><div class="line">      }</div><div class="line">      <span class="keywordflow">if</span> (tcon &lt; 0 &amp;&amp; distance &lt; fWilcke.GetRint()) tcon = t;</div><div class="line">      <span class="keywordflow">if</span> (tcon &gt; 0 &amp;&amp; tsep &lt; 0) {</div><div class="line">         <span class="keywordflow">if</span> (t &gt; tcon &amp;&amp; distance &gt; fWilcke.GetRint()) tsep = t;</div><div class="line">      }</div><div class="line">   }</div><div class="line">   <span class="comment">// friction force</span></div><div class="line">   <span class="keywordflow">if</span> (alpha &gt; 0) {</div><div class="line">      <span class="keywordflow">if</span> (fInitialDeriv) {</div><div class="line">         <span class="comment">// draw random number with mean=0 and sigma=1</span></div><div class="line">         randomX = gRandom-&gt;Gaus();</div><div class="line">      }</div><div class="line">      <span class="keywordflow">if</span> (distance &lt; fWilcke.GetRint()) {</div><div class="line">         Double_t vrel = dv(vp, vt);</div><div class="line">         Double_t vv_x = dv_x(vp, vt);</div><div class="line">         Double_t vv_y = dv_y(vp, vt);</div><div class="line">         Double_t vpar = vrel * (vv_x * uv_x + vv_y * uv_y);</div><div class="line">         Double_t FRICTION = -alpha * vpar;</div><div class="line">         Double_t fforce = FRICTION * randomX + FRICTION;</div><div class="line">         fp = fforce / (fWilcke.GetAP() * <a class="code" href="classKVNucleus.html#abbe548614194e1c1bde2550fdc3d6f54">KVNucleus::kAMU</a>);</div><div class="line">         dvp[0] += fp * (uv_x);</div><div class="line">         dvp[1] += fp * (uv_y);</div><div class="line">         ft = -fforce / (fWilcke.GetAT() * <a class="code" href="classKVNucleus.html#abbe548614194e1c1bde2550fdc3d6f54">KVNucleus::kAMU</a>);</div><div class="line">         dvt[0] += ft * (uv_x);</div><div class="line">         dvt[1] += ft * (uv_y);</div><div class="line">      }</div><div class="line">   }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> ClassTraj::Run(Double_t tmin, Double_t tmax, Double_t dt)</div><div class="line">{</div><div class="line">   <span class="comment">// Perform the simulation from time &#39;tmin&#39; to &#39;tmax&#39;.</span></div><div class="line"></div><div class="line">   Double_t Time = tmin;</div><div class="line">   tcon = tsep = -1.;</div><div class="line">   incoming = kTRUE;</div><div class="line">   interacting = kFALSE;</div><div class="line">   outgoing = kFALSE;</div><div class="line">   <span class="keywordflow">while</span> (Time &lt; tmax) {</div><div class="line">      <span class="comment">//cout &lt;&lt; &quot;ETOT = &quot; &lt;&lt; TotalEnergy() &lt;&lt; endl;</span></div><div class="line">      <span class="comment">// take Runge-Kutta step from Time to Time+dt</span></div><div class="line"></div><div class="line">      <span class="keywordflow">if</span> (outgoing) {</div><div class="line">         dt *= 1.5;</div><div class="line">         <span class="keywordflow">if</span> (Time + dt &gt; tmax) {</div><div class="line">            dt = tmax - Time;</div><div class="line">         }</div><div class="line">      }</div><div class="line">      Integrate(coords, Time, Time + dt, dt);</div><div class="line"></div><div class="line">      Time += dt;</div><div class="line">      <span class="keywordflow">if</span> (fVisualization) {</div><div class="line">         UpdateInfos(ImpactParameter, Time);</div><div class="line">         UpdateARCPositions(Time);</div><div class="line">         CMPositionPad-&gt;Modified();</div><div class="line">         CMPositionPad-&gt;Update();</div><div class="line">         LabPositionPad-&gt;Modified();</div><div class="line">         LabPositionPad-&gt;Update();</div><div class="line">      }</div><div class="line">   }</div><div class="line"></div><div class="line">   <span class="keywordflow">if</span> (fVisualization) {</div><div class="line">      ProjTRAJ-&gt;SetLineWidth(1);</div><div class="line">      ProjTRAJlab-&gt;SetLineWidth(1);</div><div class="line">      ProjTRAJ-&gt;SetLineStyle(2);</div><div class="line">      ProjTRAJlab-&gt;SetLineStyle(2);</div><div class="line">   }</div><div class="line">}</div><div class="line"></div><div class="line">Double_t ClassTraj::TotalEnergy()<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">   Double_t ekin = 0.5 * <a class="code" href="classKVNucleus.html#a488d76ebc458290c101d224aadc6aa93">KVNucleus::u</a>() * (</div><div class="line">                      fWilcke.GetAP() * (VP[0] * VP[0] + VP[1] * VP[1])</div><div class="line">                      + fWilcke.GetAT() * (VT[0] * VT[0] + VT[1] * VT[1]));</div><div class="line">   Double_t epot = fWilcke.GetTotalPotential()-&gt;Eval(dr(RP, RT));</div><div class="line">   <span class="keywordflow">return</span> ekin + epot;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> ClassTraj::CalcTrajectories(Double_t e, Double_t bmin, Double_t bmax, Double_t db, Double_t tmin, Double_t tmax, Double_t dt, Double_t friction)</div><div class="line">{</div><div class="line">   alpha = friction;</div><div class="line">   InitTree(e);</div><div class="line"></div><div class="line">   <span class="keywordflow">for</span> (Double_t b = bmin; b &lt;= bmax; b += db) {</div><div class="line"></div><div class="line">      DoOneTraj(tmin, friction, b, e, tmax, dt);</div><div class="line">   }</div><div class="line">   theFile-&gt;Write();</div><div class="line">   theFile-&gt;Close();</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> ClassTraj::InitTree(Double_t e)</div><div class="line">{</div><div class="line">   TString simTitle = Form(<span class="stringliteral">&quot;%s %f MeV/u (alpha=%f)&quot;</span>, sysName.Data(), e, alpha);</div><div class="line">   TString filename = Form(<span class="stringliteral">&quot;ClassTraj_%s_%fAMeV_alpha%f.root&quot;</span>, colName.Data(), e, alpha);</div><div class="line">   theFile = <span class="keyword">new</span> TFile(filename, <span class="stringliteral">&quot;recreate&quot;</span>);</div><div class="line">   theTree = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;ClassTrajSim&quot;</span>, simTitle);</div><div class="line">   theTree-&gt;Branch(<span class="stringliteral">&quot;ImpactParameter&quot;</span>, &amp;ImpactParameter);</div><div class="line">   theTree-&gt;Branch(<span class="stringliteral">&quot;AngMom&quot;</span>, &amp;AngMom);</div><div class="line">   theTree-&gt;Branch(<span class="stringliteral">&quot;TKEL&quot;</span>, &amp;TKEL);</div><div class="line">   theTree-&gt;Branch(<span class="stringliteral">&quot;TKE&quot;</span>, &amp;TKE);</div><div class="line">   theTree-&gt;Branch(<span class="stringliteral">&quot;VPOT&quot;</span>, &amp;VPOT);</div><div class="line">   theTree-&gt;Branch(<span class="stringliteral">&quot;minDist&quot;</span>, &amp;minDist);</div><div class="line">   theTree-&gt;Branch(<span class="stringliteral">&quot;ThetaProjLab&quot;</span>, &amp;ThetaProjLab);</div><div class="line">   theTree-&gt;Branch(<span class="stringliteral">&quot;absThetaProjLab&quot;</span>, &amp;absThetaProjLab);</div><div class="line">   theTree-&gt;Branch(<span class="stringliteral">&quot;EProjLab&quot;</span>, &amp;EProjLab);</div><div class="line">   theTree-&gt;Branch(<span class="stringliteral">&quot;fused&quot;</span>, &amp;fused);</div><div class="line">   theTree-&gt;Branch(<span class="stringliteral">&quot;inelastic&quot;</span>, &amp;inelastic);</div><div class="line">   theTree-&gt;Branch(<span class="stringliteral">&quot;RotationTime&quot;</span>, &amp;RotationTime);</div><div class="line">   theTree-&gt;Branch(<span class="stringliteral">&quot;RotationAngle&quot;</span>, &amp;RotationAngle);</div><div class="line">   theTree-&gt;Branch(<span class="stringliteral">&quot;tcon&quot;</span>, &amp;tcon);</div><div class="line">   theTree-&gt;Branch(<span class="stringliteral">&quot;tsep&quot;</span>, &amp;tsep);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> ClassTraj::DoOneTraj(Double_t tmin, Double_t friction, Double_t b, Double_t e, Double_t tmax, Double_t dt)</div><div class="line">{</div><div class="line">   minDist = 500;</div><div class="line">   InitTrajectory(b, e, friction);</div><div class="line"></div><div class="line">   ImpactParameter = b;</div><div class="line">   AngMom = fWilcke.k(e) * b;</div><div class="line"></div><div class="line">   Run(tmin, tmax, dt);</div><div class="line"></div><div class="line">   ThetaProjLab = ThetaLabProj();</div><div class="line">   EProjLab = ELabProj();</div><div class="line">   absThetaProjLab = abs(ThetaProjLab);</div><div class="line">   TKE = TotalEnergy();</div><div class="line">   TKEL = fWilcke.ECM(ELAB) - TKE;</div><div class="line">   RotationTime = (tsep &gt; 0 ? tsep - tcon : tmax - tcon);</div><div class="line">   VPOT = fWilcke.GetTotalPotential()-&gt;Eval(dr(RP, RT));</div><div class="line">   inelastic = fused = kFALSE;</div><div class="line"></div><div class="line">   <span class="keywordflow">if</span> (dr(RP, RT) &lt; fWilcke.GetRint()) fused = kTRUE;</div><div class="line">   <span class="keywordflow">if</span> (TKEL &gt; 1.e-4 &amp;&amp; !fused) inelastic = kTRUE;</div><div class="line"></div><div class="line">   <span class="comment">//cout &lt;&lt; &quot;Trot=&quot;&lt;&lt;RotationTime&lt;&lt;&quot;fm/c L=&quot;&lt;&lt;AngMom&lt;&lt;&quot;hbar Rmin=&quot;&lt;&lt;minDist&lt;&lt;&quot;fm&quot;&lt;&lt;endl;</span></div><div class="line">   Double_t Period = 2 * TMath::Pi() * fWilcke.GetMu() * <a class="code" href="classKVNucleus.html#abbe548614194e1c1bde2550fdc3d6f54">KVNucleus::kAMU</a> * minDist * minDist / (AngMom * <a class="code" href="classKVNucleus.html#a0c75d93c3ee22d153ee0fcb3d424cbef">KVNucleus::hbar</a>);</div><div class="line">   RotationAngle = 2 * TMath::Pi() * RotationTime / Period * TMath::RadToDeg();</div><div class="line">   <span class="comment">//cout&lt;&lt;&quot;Period = &quot;&lt;&lt;Period&lt;&lt;&quot;fm/c  --  Angle turned = &quot;&lt;&lt;RotationAngle&lt;&lt;&quot;deg.&quot;&lt;&lt;endl;</span></div><div class="line"></div><div class="line">   theTree-&gt;Fill();</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> ClassTraj::CalcTrajectories(Double_t e, Int_t ntraj, Double_t bmin, Double_t bmax, Double_t tmin, Double_t tmax, Double_t dt, Double_t friction)</div><div class="line">{</div><div class="line">   alpha = friction;</div><div class="line">   InitTree(e);</div><div class="line"></div><div class="line">   <span class="keywordflow">while</span> (ntraj--) {</div><div class="line"></div><div class="line">      <span class="keywordflow">if</span> (!(ntraj % 5000)) cout &lt;&lt; ntraj &lt;&lt; <span class="stringliteral">&quot; more to go...&quot;</span> &lt;&lt; endl;</div><div class="line"></div><div class="line">      Double_t b = sqrt(gRandom-&gt;Uniform(bmin * bmin, bmax * bmax));</div><div class="line">      DoOneTraj(tmin, friction, b, e, tmax, dt);</div><div class="line">   }</div><div class="line">   theFile-&gt;Write();</div><div class="line"><span class="comment">//    theFile-&gt;Close();</span></div><div class="line">   theTree-&gt;StartViewer();</div><div class="line">}</div></div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed May 30 2018 17:40:09 for KaliVeda by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
